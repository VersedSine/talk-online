<!DOCTYPE html>
<head>
    <title>Talk-online | By Vss</title>
    <meta charset="utf-8">
    <style>
        /* 设置全局字体和背景颜色 */
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
  
        /* 设置聊天框样式 */
        #chat-box {
            width: 80%;
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
        }
  
        /* 设置表单样式 */
        #message-form {
            display: flex;
            justify-content: center;
            align-items: center;
        }
  
        #message-input {
            flex: 1;
            padding: 10px;
            font-size: 16px;
            border-radius: 5px;
            border: none;
            outline: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
  
        #message-input:focus {
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
  
        button[type="submit"] {
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            background-color: #007bff;
            color: #fff;
            border: none;
            outline: none;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
  
        button[type="submit"]:hover {
            background-color: #0056b3;
        }
  
        /* 设置输出框样式 */
        #output {
            margin-top: 10px;
            font-size: 16px;
            line-height: 1.5;
        }
  
        #output br {
            display: block;
            margin-bottom: 10px;
            content: "";
        }

        .img_dice{
            height: 25px;
        }
    </style>
    <script src="./Bmob-2.4.14.min.js">var Bmob = require('./src/lib/app.js');</script>
    <script>Bmob.initialize("a4bf436ef84c46a0", "1adsfuwieriaudfm");Bmob.debug(true);</script>
</head>
<body>
    <div id="chat-box">
        <button onclick="dice()"><img class="img_dice" src="./img/dice_n.gif" alt="dice"></button>&nbsp;&nbsp;&nbsp;
        <form id="message-form">
            <input type="text" id="message-input" />
            <button type="submit">发送</button>
        </form>
        <div id="output"></div>
    </div>

    <script>
        function gebi(id){return document.getElementById(id);}
        function lot2(n){return n<10?'0'+n:n;}

        var channel=window.location.search.substr(1);console.log(`channel:${channel}`);
        var userName=channel.substr(-1)=='!'?"_testUser":window.prompt("Name?");
        while(userName=="") userName = window.prompt("Name?\nName must NOT be empty");


        var output=gebi("output");
        var s_output=[];

        function showmessages(){
            output.innerHTML = s_output.toString().split(',').join("<br>");
        }

        const queryCommunicate = Bmob.Query("communicate");
        /*var countnum;    //起始信息编号
        queryCommunicate.count().then(res => {
            countnum = res;
        });
        setInterval(function(){
            var nowCountNum;;
            queryCommunicate.count().then(res => {
                nowCountNum = res;
            });

            queryCommunicate.find().then(res => {
                countnum = res;
            });
        },1000);*/

        function print(message){
            var d=new Date();
            s_output.unshift(`<font color="green">${userName}&nbsp;&nbsp;&nbsp;${lot2(d.getHours())}:${lot2(d.getMinutes())}:${lot2(d.getSeconds())}</font><br>`+message);
            showmessages();
            
            queryCommunicate.set("userName",userName);
            queryCommunicate.set("message",message);
            queryCommunicate.save().then(res => {
                console.log(res);
            }).catch(err => {
                console.log(err);
            })
        }
        gebi("message-form").addEventListener("submit",function(event){
            event.preventDefault();
            var messageInput=gebi("message-input").value;
            gebi("message-input").value = "";
            console.log(messageInput);
            print(messageInput);
        });
        function dice(){
            print(`<img style="height: 100px" src="./img/dice_${Number(Math.floor(Math.random()*6)+1)}.gif">`);
        }

    </script>
</body>